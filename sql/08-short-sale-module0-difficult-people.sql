-- =============================================
-- NEW Module 1 for Short Sale Course:
-- Handling Difficult Buyers, Sellers, and Agents in Complex Transactions
-- Run AFTER 07-short-sale-content.sql
-- This inserts a new module at sort_order 0 (so it appears first)
-- and bumps existing modules to maintain order.
-- =============================================

DO $$
DECLARE
  v_course_id INTEGER;
  v_mod0 INTEGER;
BEGIN

SELECT id INTO v_course_id FROM courses WHERE slug = 'representing-client-short-sale';

IF v_course_id IS NULL THEN
  RAISE EXCEPTION 'Course not found. Run 05-add-courses.sql first.';
END IF;

-- Bump existing modules up by 1 so the new module can be sort_order 1
UPDATE course_modules
SET sort_order = sort_order + 1
WHERE course_id = v_course_id;

-- =============================================
-- NEW MODULE 1: Handling Difficult People in Complex Transactions
-- =============================================
INSERT INTO course_modules (title, section, description, tier, sort_order, course_id)
VALUES (
  'Handling Difficult Buyers, Sellers, and Agents',
  'Professional Foundations',
  'Before diving into the mechanics of short sales, master the interpersonal skills you need to navigate high-stress transactions. Learn how to manage difficult personalities, de-escalate conflicts, and maintain professionalism when emotions run high.',
  'free',
  1,
  v_course_id
) RETURNING id INTO v_mod0;

-- Lesson 1: The Psychology of Difficult People in Real Estate
INSERT INTO course_lessons (id, module_id, title, content, sort_order) VALUES
('ss-0-1', v_mod0, 'The Psychology of Difficult People in Real Estate', E'# The Psychology of Difficult People in Real Estate\n\nComplex transactions like short sales, foreclosures, and distressed property deals bring out the worst in people — not because they are bad people, but because they are under extraordinary stress. Understanding why people become difficult is the first step to managing them effectively.\n\n## Why Complex Transactions Create Difficult Behavior\n\nReal estate is already one of the most stressful experiences in a person''s life. Now add financial distress, legal uncertainty, and the threat of losing a home. The result is a perfect storm of emotional reactions.\n\n### The Stress Response\n\nWhen people are under severe stress, their brain shifts from rational decision-making to survival mode:\n\n- **Fight response:** Anger, aggression, blaming others, threatening lawsuits, making unreasonable demands\n- **Flight response:** Avoidance, ignoring calls, refusing to provide documents, ghosting\n- **Freeze response:** Inability to make decisions, paralysis, procrastination, shutting down emotionally\n\nRecognizing which stress response you are dealing with helps you choose the right approach.\n\n## The Five Types of Difficult People in Real Estate\n\n### 1. The Angry Blamer\n**Who they are:** Sellers who blame the bank, the market, their ex-spouse, or you for their situation. Buyers who feel the process is unfair. Agents who lash out when things don''t go their way.\n\n**What drives them:** Fear and loss of control. Blaming others is a way to avoid confronting painful realities.\n\n**How to handle them:**\n- Let them vent — do not interrupt or get defensive\n- Acknowledge their feelings: \"I understand this is incredibly frustrating.\"\n- Redirect to what CAN be controlled: \"Here''s what we can do right now...\"\n- Never argue or take the bait when they try to provoke you\n- Set firm but respectful boundaries: \"I''m here to help you, and I need us to work together to solve this.\"\n\n### 2. The Avoider\n**Who they are:** Sellers who won''t return calls, provide documents, or sign papers. Buyers who go silent for weeks. Agents who stop responding.\n\n**What drives them:** Overwhelm. The problem feels so big that any action feels pointless. Sometimes shame prevents them from engaging.\n\n**How to handle them:**\n- Simplify: \"I just need one thing from you today — your last two bank statements.\"\n- Remove barriers: \"Can I come pick up the documents? I''ll bring a scanner.\"\n- Be persistent but gentle — multiple follow-ups through different channels (call, text, email)\n- Explain consequences without threatening: \"If we don''t submit this by Friday, the lender may close the file.\"\n- Offer to handle as much as possible on their behalf\n\n### 3. The Know-It-All\n**Who they are:** Clients or agents who have read a few articles and think they are experts. They second-guess every decision, quote outdated information, and resist professional advice.\n\n**What drives them:** Anxiety masked as overconfidence. By being the \"expert,\" they feel more in control of a scary situation.\n\n**How to handle them:**\n- Acknowledge their knowledge: \"You''ve clearly done your research.\"\n- Gently correct misinformation with evidence: \"That was true a few years ago, but the current guidelines say...\"\n- Position your advice as collaboration: \"Based on my experience with this lender, here''s what I recommend. What do you think?\"\n- Provide data and documentation to support your recommendations\n- Never make them feel stupid — build on what they know\n\n### 4. The Unreasonable Demander\n**Who they are:** Buyers who want a 50% discount and refuse to budge. Sellers who insist their home is worth twice its value. Agents who demand impossible timelines or terms.\n\n**What drives them:** Unrealistic expectations, often fueled by stories from friends or the internet, or simply a negotiation tactic.\n\n**How to handle them:**\n- Use data, not opinions: \"Here are five comparable sales that support this price range.\"\n- Let reality do the talking: \"The lender will order their own valuation. If our price is off, they''ll tell us.\"\n- Set clear boundaries: \"I want to get you the best deal possible, and here''s what is realistic.\"\n- Be willing to walk away: \"If this price doesn''t meet your needs, I understand — this may not be the right property for you.\"\n- Never agree to unreasonable terms just to keep the peace\n\n### 5. The Emotionally Overwhelmed\n**Who they are:** Sellers losing their home. Buyers who''ve been searching for months. Anyone going through divorce, job loss, illness, or grief simultaneously with a real estate transaction.\n\n**What drives them:** Genuine emotional pain. The transaction represents much more than just a house — it represents their stability, identity, and future.\n\n**How to handle them:**\n- Lead with empathy — always\n- Slow down: \"There''s no rush on this decision. Take the time you need.\"\n- Break big decisions into smaller steps\n- Check in on them as people, not just clients: \"How are you doing through all of this?\"\n- Know your limits — you are not a therapist. Recommend professional support when appropriate.\n- Protect their interests even when they are not thinking clearly\n\n## The Universal Rules\n\nRegardless of the type of difficult person you are dealing with:\n\n1. **Never take it personally.** Their behavior is about their stress, not about you.\n2. **Stay calm.** Your composure is contagious. If you stay steady, they are more likely to calm down.\n3. **Listen more than you talk.** People who feel heard become more cooperative.\n4. **Document everything.** When emotions run high, written records protect everyone.\n5. **Control what you can control.** You cannot change people — you can only change how you respond to them.\n\n## Summary\n\nDifficult people in complex transactions are not the exception — they are the norm. Understanding what drives their behavior and having strategies to manage each type will make you more effective, less stressed, and more successful in every transaction you handle.', 1),

-- Lesson 2: De-Escalation and Conflict Resolution
('ss-0-2', v_mod0, 'De-Escalation and Conflict Resolution Techniques', E'# De-Escalation and Conflict Resolution Techniques\n\nConflict is inevitable in complex transactions. Multiple parties with competing interests, tight timelines, financial stress, and emotional investment create a recipe for confrontation. Your ability to de-escalate and resolve conflicts is one of your most valuable professional skills.\n\n## The LEAP Method for De-Escalation\n\nUse this four-step framework when a conversation gets heated:\n\n### L — Listen Actively\n- Stop talking and give the person your full attention\n- Do not check your phone, look at your computer, or multitask\n- Use verbal cues: \"I hear you.\" \"Go on.\" \"Tell me more.\"\n- Let them finish completely before responding\n- Take notes to show you are taking them seriously\n\n### E — Empathize Genuinely\n- Acknowledge their emotion before addressing the issue: \"I can see how upsetting this is.\"\n- Use phrases like:\n  - \"That sounds really frustrating.\"\n  - \"I would feel the same way in your situation.\"\n  - \"I understand why this is so stressful.\"\n- Empathy is not agreement — you can validate someone''s feelings without agreeing with their position\n\n### A — Ask Clarifying Questions\n- Once they have vented, get to the root of the problem: \"Help me understand exactly what happened.\"\n- Ask open-ended questions: \"What would a good outcome look like for you?\"\n- Identify the real issue — it is often different from what they are complaining about\n- Confirm your understanding: \"So if I understand correctly, the main concern is...\"\n\n### P — Partner on a Solution\n- Shift from adversarial to collaborative: \"Let''s figure this out together.\"\n- Offer options rather than ultimatums: \"Here are two ways we could handle this...\"\n- Focus on what you CAN do, not what you cannot\n- Get agreement on next steps and follow up promptly\n\n## Common Conflict Scenarios and Scripts\n\n### Scenario: Angry Seller Blames You for the Lender''s Slow Response\n\n**Seller:** \"This is ridiculous! It''s been three months and the bank hasn''t responded! What have you been doing this whole time? I''m going to find another agent.\"\n\n**Bad response:** \"I''ve called them 50 times! It''s not my fault the bank is slow!\"\n\n**Good response:** \"I completely understand your frustration — three months is a long time to wait, and I know how stressful this uncertainty is. Let me share exactly where we stand: I''ve contacted the lender 12 times since our submission, and here is the status as of my last call on Tuesday. The BPO was completed and the file is with the decision-maker. Here is what I plan to do this week to push for a faster answer. Can we schedule a call Friday so I can update you?\"\n\n**Why this works:** You validated the emotion, provided evidence of your work, gave a clear status, and offered a concrete next step.\n\n### Scenario: Buyer''s Agent Is Hostile About the Timeline\n\n**Agent:** \"My buyer is done waiting. Either you get this approved this week or we''re walking. I''m sick of dealing with this.\"\n\n**Bad response:** \"Then walk. I have other offers.\"\n\n**Good response:** \"I hear you, and I appreciate your buyer''s patience. I know this has been a long process. Here is the latest: the lender has the BPO and I expect a decision within the next two weeks. I will call you every Tuesday and Thursday with updates. If your buyer needs to explore other options in the meantime, I completely understand. But I believe we are close, and I would hate for them to lose this opportunity.\"\n\n**Why this works:** You acknowledged the frustration, provided a timeline, committed to communication, respected their option to leave, and reminded them of the opportunity.\n\n### Scenario: Co-Owner Disagrees with the Other Co-Owner\n\n**Owner A:** \"I want to sell at $250,000. My brother wants $300,000 and he''s being completely unreasonable.\"\n\n**Bad response:** \"Your brother is wrong. The house is only worth $250,000.\"\n\n**Good response:** \"I understand you two see this differently, and that is completely normal when co-owners are making a big decision. Let me share the comparable sales data with both of you so we can have a conversation based on the numbers rather than opinions. Would it be helpful if we all sat down together to review the market analysis?\"\n\n**Why this works:** You remained neutral, introduced data as the arbiter (instead of taking sides), and offered a collaborative path forward.\n\n### Scenario: Seller Threatens to Stop Cooperating\n\n**Seller:** \"I''m done. I don''t care anymore. Let the bank take it.\"\n\n**Bad response:** \"That would be a huge mistake. You really need to keep going.\"\n\n**Good response:** \"I hear you. You are exhausted and this process has been incredibly draining. Can I be honest with you? If we stop now, the foreclosure will go through and the impact on your credit and finances will be significantly worse. We are closer than you think to getting this resolved. What if I handle everything from here — all I need from you is one signature. Can you give me that?\"\n\n**Why this works:** You validated the exhaustion, honestly explained consequences without lecturing, reminded them of progress, and reduced their burden to the absolute minimum.\n\n## Working with Difficult Agents\n\nSometimes the hardest person in the transaction is the other agent.\n\n### Types of Difficult Agents\n\n**The Bully:** Threatens, raises their voice, makes demands. Handle by staying calm, documenting behavior, and involving your broker if needed.\n\n**The Incompetent:** Does not understand the process, submits incomplete paperwork, misses deadlines. Handle by guiding them through the process (it helps your client) and documenting everything.\n\n**The Ghost:** Stops responding to calls and emails. Handle by communicating through multiple channels, setting deadlines in writing, and involving their broker.\n\n**The Underminer:** Goes around you to your client, second-guesses your advice, tries to renegotiate directly. Handle by immediately reestablishing your role and reminding all parties of proper communication channels.\n\n### The Golden Rule with Other Agents\n\nNo matter how difficult they are, always:\n- Remain professional in all communications\n- Put important things in writing\n- Never badmouth them to clients\n- Involve brokers early if behavior is unacceptable\n- Remember: your reputation is your most valuable asset\n\n## When to Involve Your Broker\n\nEscalate to your broker when:\n- The other agent is harassing or threatening you\n- A client is making unreasonable demands that put you at legal risk\n- A conflict cannot be resolved through direct communication\n- You need a neutral third party to mediate\n- You feel unsafe in any way\n\nYour broker has experience handling difficult situations and can provide support, intervention, or take over communication if necessary.\n\n## Summary\n\nDe-escalation and conflict resolution are not soft skills — they are essential professional competencies. The LEAP method (Listen, Empathize, Ask, Partner) provides a framework for any difficult conversation. Practice these techniques in every transaction, and you will become known as the agent who can handle anything.', 2),

-- Lesson 3: Setting Boundaries and Protecting Yourself
('ss-0-3', v_mod0, 'Setting Boundaries and Protecting Yourself Professionally', E'# Setting Boundaries and Protecting Yourself Professionally\n\nComplex transactions demand more of your time, energy, and emotional capacity than standard deals. Without clear boundaries, you risk burnout, liability, and compromised service to all of your clients.\n\n## Why Boundaries Matter in Complex Transactions\n\nShort sales, foreclosures, and distressed property deals have unique characteristics that test boundaries:\n\n- **Extended timelines** — transactions that take months instead of weeks\n- **Emotional clients** — people in crisis who may lean on you heavily\n- **Difficult counterparties** — lenders, attorneys, and agents who create friction\n- **Scope creep** — clients asking you to do things outside your role (legal advice, financial counseling, emotional therapy)\n- **Unpredictable schedules** — lender calls, urgent document requests, and last-minute changes\n\nWithout boundaries, you will eventually fail your clients — not because you do not care, but because you have nothing left to give.\n\n## Professional Boundaries to Establish\n\n### Communication Boundaries\n\n**Set expectations at the start:**\n- \"I am available by phone and email Monday through Friday, 9 AM to 6 PM. For urgent matters outside those hours, please text me and I will respond as soon as I can.\"\n- \"I will update you every [Tuesday] with a status report, even if nothing has changed.\"\n- \"The best way to reach me for quick questions is [text/email]. For longer discussions, let''s schedule a call.\"\n\n**Why this matters:** Without communication boundaries, distressed clients may call at all hours, expecting immediate responses. This leads to burnout and resentment.\n\n### Scope Boundaries\n\nBe clear about what you do and do not do:\n\n**You DO:**\n- Market and sell the property\n- Negotiate with lenders on pricing and terms\n- Coordinate the transaction from listing to closing\n- Refer clients to appropriate professionals\n\n**You DO NOT:**\n- Give legal advice (\"I am not an attorney, but I can connect you with one who specializes in this.\")\n- Give tax advice (\"You should discuss the tax implications with your CPA before we proceed.\")\n- Provide financial counseling (\"A HUD-approved housing counselor can help you evaluate all your options.\")\n- Make personal financial decisions for clients (\"Ultimately, this is your decision. Here is the information to help you decide.\")\n\n### Emotional Boundaries\n\nYou can care deeply about your clients without absorbing their pain:\n\n- **Empathy, not absorption:** Feel with them, but do not carry their burden home\n- **Support, not rescue:** You can help them through the process, but you cannot fix their life\n- **Professional concern, not personal responsibility:** You are responsible for doing your job well, not for the outcome of their financial situation\n\n### Time Boundaries\n\n- Do not sacrifice other clients'' service quality for one demanding client\n- Block time for proactive work (lender follow-up, document preparation) rather than being purely reactive\n- Schedule specific times for lender calls rather than being on hold all day\n- Take days off — complex transactions are marathons, and you need rest\n\n## Protecting Yourself Legally\n\n### Document Everything\n\nIn complex transactions, your documentation is your shield:\n\n- **Emails over phone calls** — whenever possible, communicate in writing\n- **Follow up verbal conversations** with a summary email: \"Per our conversation today, we agreed to...\"\n- **Keep a transaction log** — date, time, action taken, person contacted, outcome\n- **Save all documents** — submissions, responses, approval letters, and correspondence\n- **Get signatures** on all disclosures, agreements, and authorizations\n\n### Disclosures\n\nProtect yourself with proper disclosures:\n\n- **Short sale disclosure** — inform the buyer that the sale is subject to lender approval and may take months\n- **As-is disclosure** — clearly state the property is being sold in its current condition\n- **No legal/tax advice disclosure** — document that you have recommended professional consultation\n- **Deficiency risk disclosure** — ensure the seller understands the potential for ongoing liability\n- **Arms-length affidavit** — confirm no hidden relationships between parties\n\n### When to Say No\n\nSome situations require you to decline or withdraw:\n\n- **The client asks you to do something unethical** — misrepresent the property, hide offers, inflate values\n- **The client refuses to cooperate** — will not provide documents, attend closings, or follow through\n- **The transaction is clearly fraudulent** — straw buyers, hidden relationships, value manipulation\n- **The client is abusive** — threatening, harassing, or creating an unsafe situation\n- **The workload exceeds your capacity** — it is better to refer than to do a poor job\n\nSaying no protects you, your license, and ultimately your client.\n\n## Managing Your Energy\n\n### Recognize Burnout Signs\n- Dreading client calls\n- Losing patience more quickly than usual\n- Difficulty sleeping due to transaction stress\n- Neglecting other clients or personal responsibilities\n- Feeling hopeless about transaction outcomes\n\n### Prevention Strategies\n- Limit the number of active short sale/complex listings at any time\n- Build a support system — assistants, transaction coordinators, mentors\n- Celebrate wins, even small ones (\"The BPO is done — we are one step closer!\")\n- Maintain activities outside of work that recharge you\n- Talk to a mentor or colleague when a transaction is weighing on you\n\n### The Oxygen Mask Principle\nJust like on an airplane: put your own mask on first. You cannot serve your clients effectively if you are depleted. Taking care of yourself is not selfish — it is professional.\n\n## Summary\n\nSetting boundaries is not about caring less — it is about caring sustainably. Clear communication boundaries, defined scope of service, emotional awareness, thorough documentation, and energy management allow you to serve your clients at the highest level throughout the long, demanding process of complex transactions.', 3);

-- Module Quiz
INSERT INTO course_quizzes (module_id, question, options, correct_index, sort_order) VALUES
(v_mod0, 'When a distressed seller is angry and blaming you for the lender''s slow response, what should you do FIRST?', '["Defend yourself by listing all the calls you have made", "Tell them to find another agent if they are unhappy", "Listen and acknowledge their frustration before providing a status update", "Blame the lender and agree that the system is broken"]', 2, 1),
(v_mod0, 'What does the "E" in the LEAP de-escalation method stand for?', '["Evaluate the situation", "Empathize genuinely", "Explain your position", "Eliminate the problem"]', 1, 2),
(v_mod0, 'An agent who "freezes" — avoids calls, stops providing documents, and seems paralyzed — is most likely experiencing what?', '["Laziness", "Fraud", "Overwhelm from stress", "Disinterest in the transaction"]', 2, 3),
(v_mod0, 'When should you involve your broker in a difficult situation?', '["Only when you are about to lose a commission", "When the other agent is harassing you, a client puts you at legal risk, or you feel unsafe", "Never — handling everything alone shows competence", "Only after the transaction has closed"]', 1, 4),
(v_mod0, 'Why is it important to follow up verbal conversations with a written summary email?', '["It wastes the other party''s time", "It creates a documented record that protects all parties", "It is legally required in all states", "It is only necessary for transactions over $500,000"]', 1, 5);

RAISE NOTICE 'New introductory module added successfully! 3 lessons, 5 quiz questions. Existing modules bumped to sort_order 2-7.';

END $$;
